{% extends 'base.html' %}

{% block head %}
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
<script type="text/javascript" charset="utf-8">
    $(document).ready(function() {
        var socket = io.connect('http://' + document.domain + ':' + location.port + '/roll');
        socket.on('connect', function() {
            console.log('Connected');
        });
        socket.on('users', function(data) {
            $('#users').html(data);
        });
        socket.on('roll_event', function() {
            loadHistory();
        });
        $('#roll').on('click', function(e) {
            e.preventDefault();
            socket.emit('roll_request', {
                ability: $('#dice_ability').val(),
                bonus: $('#dice_bonus').val()
            });
        });
        function loadHistory() {
            $('#history').load('{{ url_for('history') }}');
        }
        loadHistory();
    });
</script>
{% endblock head %}

{% block content %}

<ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active">
        <a href="#home" aria-controls="home" role="tab" data-toggle="tab">Dice</a>
    </li>
    <li role="presentation">
        <a href="#reference" aria-controls="reference" role="tab" data-toggle="tab">Reference</a>
    </li>
    <li role="presentation">
        <a href="#intrigue" aria-controls="intrigue" role="tab" data-toggle="tab">Intrigue</a>
    </li>
</ul>
<div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="home">
        <div class="row">
            <div class="col-md-12">
                <h2>ASOIAF RPG Dice Roller</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-md-9">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <div id="control" class="float-middle">
                            <div class="row">
                                <div class="col-sm-2 col-sm-offset-3">
                                    <input type="text" class="form-control" id="dice_ability" placeholder="Ability dice">
                                </div>
                                <div class="col-sm-2">
                                    <input type="text" class="form-control" id="dice_bonus" placeholder="Bonus dice">
                                </div>
                                <div class="col-sm-2">
                                    <button class="btn btn-primary" id="roll">Roll</button>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div id="history"><span class="loading">Loading ...</span></div>
                        {% if session.get('name') == 'Matt' %}
                            <br><hr><a href="{{ url_for('clear_history') }}" class="btn btn-danger btn-xs">Clear</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="panel panel-default">
                    <div class="panel-heading">
                    <div class="clearfix">
                        <h3 class="pull-left panel-title">People</h3>
                        <a href="{{ url_for('logout_page') }}"><span class="pull-right label label-danger">Leave</span></a>
                    </div>
                    </div>
                    <div class="panel-body">
                        <div>
                            <p id="users"><span class="loading">Loading ...</span></p>
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">How to use this app</h3>
                    </div>
                    <div class="panel-body">
                        <p>
                            In the two textboxes at the top of the screen in the middle, input the number of dice
                            you have for the test's relevant <strong>ability</strong> in the first box, and the number
                            of any <strong>bonus</strong> dice you get to add to the test. Then, click <strong>Roll</strong>.
                            <br><br>
                            Your rolls and everyone else's rolls will appear in the middle of the screen in reverse
                            chronological order (so the most recent rolls are at the top). The "Result" column shows your 
                            results in the order <code>raw rolls -> top dice you keep -> final value</code>.
                            <br><br>
                            If you need to change your name, use the <strong>Leave</strong> link in the upper-right of the
                            screen to go back to the sign-in page.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div role="tabpanel" class="tab-pane" id="reference">
        <div class="row">
            <div class="col-lg-12">
                <h2>Reference</h2>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Quick Reference</h3>
                    </div>
                    <div class="panel-body">
                        <p>
                            Let me know what you want here.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div role="tabpanel" class="tab-pane" id="intrigue">
        <div class="row">
            <div class="col-lg-12">
                <h2>Intrigue</h2>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Stats</h3>
                    </div>
                    <div class="panel-body">
                        <h3 class="nomartop">Defense</h3>
                        <p>= Awareness + Cunning + Status + Bonuses</p>
                        <h3>Composure</h3>
                        <p>= 3 x Will</p>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Structure</h3>
                    </div>
                    <div class="panel-body">
                        <ol>
                            <li>Type</li>
                            <li>Scene</li>
                            <li>Objective</li>
                            <li>Disposition</li>
                            <li>Initiative</li>
                            <li>Technique</li>
                            <li>Roleplaying</li>
                            <li>Actions and Tests</li>
                            <li>Repeat</li>
                            <li>Resolution</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}
