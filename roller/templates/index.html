{% extends 'base.html' %}

{% block head %}
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
<script type="text/javascript" charset="utf-8">
    $(document).ready(function() {
        var socket = io.connect('http://' + document.domain + ':' + location.port + '/roll');
        socket.on('connect', function() {
            console.log('Connected');
        });
        socket.on('users', function(data) {
            console.log('"users" event');
            $('#users').html(data);
        });
        socket.on('roll_event', function(data) {
            console.log('"roll_event" event');
            loadHistory();
        });
        $('#roll').on('click', function(e) {
            e.preventDefault();
            socket.emit('roll_request', {
                ability: $('#dice_ability').val(),
                specialty: $('#dice_specialty').val()
            });
        });
        function loadHistory() {
            $('#history').load('{{ url_for('history') }}');
        }
        loadHistory();
    });
</script>
{% endblock head %}

{% block content %}
<div class="row">
    <div class="col-md-10">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Rolling</h3>
            </div>
            <div class="panel-body">
                <div id="control">
                    <form class="form-inline">
                        <div class="form-group">
                            <label for="dice_ability">Ability</label>
                            <input type="text" class="form-control" id="dice_ability" placeholder="2">
                        </div>
                        <div class="form-group">
                            <label for="dice_specialty">Specialty</label>
                            <input type="text" class="form-control" id="dice_specialty" placeholder="0">
                        </div>
                        <button class="btn btn-primary" id="roll">Roll</button>
                    </form>
                </div>
                <hr>
                <div id="history"></div>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">People</h3>
            </div>
            <div class="panel-body">
                <div>
                    <p id="users"></p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}
